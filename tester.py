import unittest

import jsonutils
import datetime
import window_timer as wt
import os
import sys
from PyQt5.QtWidgets import QVBoxLayout, QMainWindow, QApplication, QLabel, QWidget, QPushButton, QLineEdit, QHBoxLayout


class TestApp(unittest.TestCase):
    def setUp(self):
        self.maxDiff = None
        self.timer = wt.TimesStruct()
        self.new_path = jsonutils.JsonUtils.convert_file("tester_file")

        self.one_app = {
            "RunningTotal": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                }
            },
            "Firefox": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                }
            }
        }

    def test_convert_file(self):
        sample_name = "test"
        file = str(sample_name) + ".json"
        path = os.path.dirname(os.path.realpath(__file__))
        self.assertEqual(rf"{path}\data\{file}", jsonutils.JsonUtils.convert_file(sample_name))

    def test_find_current_path(self):
        current = datetime.date.today()
        current += datetime.timedelta(days=-current.weekday(), weeks=0)

        self.assertEqual(jsonutils.JsonUtils.find_current_path(), jsonutils.JsonUtils.convert_file(current))

    def test_read_write(self):
        jsonutils.JsonUtils.write(self.new_path, {})
        self.assertTrue(os.path.isfile(self.new_path))
        self.assertEqual(jsonutils.JsonUtils.read(self.new_path), {})
        os.remove(self.new_path)

    def test_add_app(self):
        self.set_add_app()
        self.assertTrue(os.path.isfile(self.new_path))
        os.remove(self.new_path)

    def set_add_app(self):
        self.timer.path = self.new_path
        self.timer.add()

    def test_create_app(self):
        self.set_add_app()

        two_app = {
            "RunningTotal": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                }
            },
            "Firefox": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                }
            },
            "Pycharm64": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                }
            }
}

        self.timer.create_app("Firefox")

        self.assertEqual(self.timer.times, self.one_app)

        self.timer.create_app("Pycharm64")

        self.assertEqual(self.timer.times, two_app)

        os.remove(self.new_path)

    def test_update(self):
        self.set_add_app()

        # I just hardcoded the hour and day in, which will change depending on when you run the program

        one_updated = {
            "RunningTotal": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                }
            },
            "Firefox": {
                # 0 IS MONDAY!!!
                "0": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "1": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "2": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "3": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "4": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "5": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 0,
                },
                "6": {
                    "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0,
                    "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0,
                    "12": 0, "13": 0, "14": 0, "15": 0, "16": 0, "17": 0,
                    "18": 0, "19": 0, "20": 0, "21": 0, "22": 0, "23": 5,
                }
            }
        }

        self.timer.create_app("Firefox")
        self.timer.update("Firefox")
        self.assertEqual(self.timer.times, one_updated)

    def test_send_to_json(self):
        self.set_add_app()
        self.timer.create_app("Firefox")
        self.timer.send_to_json()
        self.assertEqual(jsonutils.JsonUtils.read(self.new_path), self.one_app)
        os.remove(self.new_path)
